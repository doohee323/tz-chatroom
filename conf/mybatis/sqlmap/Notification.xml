<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.locket.notification.models.Notification">
	<parameterMap id="inputMap" type="java.util.HashMap" />
	<resultMap id="resultMap" type="java.util.HashMap" />

	<resultMap id="notificationResultMap" type="com.locket.notification.models.Notification">
		<id property="id" column="id" />
		<result property="userId" column="user_id" />
		<result property="title" column="title" />
		<result property="createdAt" column="created_at" />
		<result property="updatedAt" column="updated_at" />
	</resultMap>

	<select id="getAllNotification" resultMap="notificationResultMap">
		SELECT * FROM
		Notification
	</select>

	<select id="getAllNotification2" resultMap="resultMap">
		SELECT * FROM
		Notification
	</select>

	<select id="getNotification" parameterType="String"
		resultMap="notificationResultMap">
		SELECT id, user_id, title
		, DATE_FORMAT(NOW(), '%d %m %Y') as
		created_at
		, DATE_FORMAT(updated_at,'%y.%m.%d') as updated_at
		FROM
		Notification
		<where>
			id = #{input}
		</where>
		<!-- <where> -->
		<!-- <if test="requestAt != null"> -->
		<!-- WHERE CREATED_AT >= #{requestAt} -->
		<!-- </if> -->
		<!-- </where> -->
	</select>

	<select id="getNotification2" parameterMap="inputMap" resultMap="resultMap">
		SELECT * FROM
		Notification
		<where>
			<if test="requestAt != null">
				CREATED_AT >= #{requestAt}
			</if>
		</where>
	</select>

	<insert id="createNotification" parameterType="com.locket.notification.models.Notification">
		insert into
		Notification (id, user_id, title)
		values ((select * from (select max(id) + 1 from Notification) next),
		#{userId}, #{title})
	</insert>

	<update id="updateNotification">
		update Notification set
		userId = #{userId},
		title = #{title},
		updated_at = now()
		where id = #{id}
	</update>

	<delete id="deleteNotification">
		delete Notification 
		where id = #{id}
	</delete>
</mapper>
 
