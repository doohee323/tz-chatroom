"use strict";function gf_MergeData(a,b){for(var c=0;c<Object.keys(a).length;c++)b[Object.keys(a)[c]]=a[Object.keys(a)[c]];return b}function gf_SetCookie(a,b){var c=new Date;c.setTime(c.getTime()+2592e6),document.cookie=a+"="+escape(b)+"; path=/; expires="+c.toGMTString()+"; "}function gf_GetCookie(a){for(var b=a+"=",c=0;c<=document.cookie.length;){var d=c+b.length;if(document.cookie.substring(c,d)==b)return-1==(endOfCookie=document.cookie.indexOf(";",d))&&(endOfCookie=document.cookie.length),unescape(document.cookie.substring(d,endOfCookie));if(c=document.cookie.indexOf(" ",c)+1,0==c)break}return"loclCd"==a?(gf_SetCookie("loclCd","en_US"),"en_US"):""}function gf_Trace(a){"undefined"!=typeof window.console&&console.log(a)}function gf_IsNull(a){if("undefined"==new String(a).valueOf())return!0;if(null==a)return!0;var b=new String(a);return null==b?!0:0==b.toString().length?!0:!1}function gf_setNullInit(a,b){return gf_IsNull(a)?b:a}function gf_FindLang(a,b){gf_IsNull(b)&&(b=gf_GetCookie("loclCd")),gf_IsNull(b)&&(b="en_US");var c="";try{c=jquery_lang_js.prototype.lang[b][a]}catch(d){gf_Trace(d.message)}return gf_IsNull(c)&&(c=a),c}function gf_AlertMsg(a,b){if(gf_IsNull(a))return alert("No message Id!"),null;var c=gMsg.getMsg(ezMessage(a),b);return alert(c,gf_FindLang("������")),c}function gf_ConfirmMsg(a,b){return gf_IsNull(a)?(alert("No message Id!"),null):confirm(gMsg.getMsg(ezMessage(a),b),"OK")}function ezMessage(a){var b=gf_GetCookie("loclCd");try{if(a=a.simpleReplace(".","_"),gf_IsNull(gv_DnlsComm.msg[b][a]))return a.simpleReplace("_",".");var c=gv_DnlsComm.msg[b][a].message;if(gf_IsNull(c))return a}catch(d){c=a}return c}function coMessage(){this.getMsg=coMessage_getMsg}function coMessage_getMsg(a,b){try{if(null==a||""==a)return null;var c=0,d=0;if(null==b)return a;for(var e=0;e<b.length;e++)gf_IsNull(b[e])||(b[e]=b[e].toString().replace("'","���"));for(;-1!=(c=a.indexOf("@",c));){null==b[d]&&(b[d]="");var f=a.substring(c+1,c+2),g=f.match(/[^0-9]/g);null==g?(f=parseInt(f)-1,a=a.substr(0,c)+String(gf_FindLang(b[f]))+a.substring(c+2,a.length)):a=a.substr(0,c)+String(gf_FindLang(b[d]))+a.substring(c+1,a.length),c+=String(gf_FindLang(b[d++])).length}}catch(h){return gf_Trace("Error occurred!!! : coMessage_getMsg"+h.message),"Error occurred!!! : coMessage_getMsg"}return a}function gf_GetValue(a){return gf_IsNull(a)?"":a}function gf_GetNextDate(){var a=new Date;return a.setDate(a.getDate()+1),a}function gf_SelectedValue(a,b){for(var c=a.options,d=c.length,e=0;d>e;){if(c[e].value==b)return void(a.selectedIndex=e);e++}}function gf_Json2list(a){function b(a){for(var e in a)a.hasOwnProperty(e)&&("object"==typeof a[e]?b(a[e]):(c!=a&&d.push(a),c=a));return d}var c,d=a;return b(a),d}function gf_SortListWithLevel(a,b){var c,d={},e={};for(c=0;c<a.length;c++){var f=a[c].id,g={id:f,level:b,children:[],sorted:!1};d[f]=a[c],e[f]=g}for(c=0;c<a.length;c++){var h,g=e[a[c].id],i=g,j=d[i.id].hgr_id;for(h=0;j in e;h++)i=e[j],0==h&&i.children.push(g.id),g.level++,j=d[i.id].hgr_id}var k=[];for(var l in e)k.push(e[l]);var m=[];for(c=0;c<k.length;c++){var g=k[c],n=d[g.id].hgr_id;if(n in d){var h,i=e[n];for(h=0;h<i.children.length;h++){var o=e[i.children[h]];o.sorted||(d[o.id].level=o.level,m.push(d[o.id]),o.sorted=!0)}}else g.sorted||(d[g.id].level=g.level,m.push(d[g.id]),g.sorted=!0)}return m}function gf_Scope(a,b){function c(a,b){for(var g in a)if(a.hasOwnProperty(g))if("object"==typeof a[g]&&null!=a[g]&&a[g].$id&&-1==f.indexOf(a[g].$id+","))f+=a[g].$id+",",c(a[g],b);else{if(d!=a&&a[b])return e=a,a;d=a}return null}var d,e,f="";return a=a.$root,c(a,b),e}function gf_ScopeWithId(a,b){function c(a,b){for(var g in a)if(a.hasOwnProperty(g))if("object"==typeof a[g]&&null!=a[g]&&a[g].$id==b)f+=a[g].$id+",",c(a[g],b);else{if(d!=a&&a[b])return e=a,a;d=a}return null}var d,e,f="";return a=a.$root,c(a,b),e}function gf_GetPoppyFrame(a,b){var c="";b&&(c=b);var d=a.getElementById("poppy");return null==d&&a.body.insertAdjacentHTML("beforeEnd","<div id='poppy'/></div>"),a.getElementById("poppy").innerHTML="<iframe id='poppyFrame"+c+"' name='poppyFrame"+c+"' src='about:blank' style='width:0;height:0;border:0;frameborder:0;padding:0;margin:0' scrolling=no></iframe>",d=a.getElementById("poppyFrame"+c)}function gf_CopyToClipboard(a){var b=document.all?!0:!1;if(b)window.clipboardData.setData("Text",a);else{prompt("Click Ctrl+C for saving this to clipboard.",a)}}function getDeviceInfo(){var a={},b=navigator.userAgent+"^"+navigator.platform;if(b.indexOf("Android")>-1){var c="SHW-M180S,SHW-M180L,SCH-I800,SGH-T849".split(","),d=b.split(";"),e=(d[3],d[4].split("/")),f=e[0];a.osVersion=e[1].substring(0,e[1].indexOf(")")),a.deviceModelName=f;for(var g=0;g<c.length;g++)if(f.indexOf(c[g])>-1){a.osType="androidTablet";break}a.osType||(a.osType="androidPhone")}else if(b.indexOf("Mac OS")>-1){var c="iPhone,iPod".split(","),d=b.split(";"),h=d[0].substring(d[0].indexOf("(")+1,d[0].length);a.osVersion=d[2].substring(d[2].indexOf("OS")+3,d[2].indexOf("like")-1);{d[3].substring(1,d[3].indexOf(")"))}a.deviceModelName=b;for(var g=0;g<c.length;g++)if(h.indexOf(c[g])>-1){a.osType="applePhone";break}a.osType||(a.osType="appleTablet")}else/msie/.test(navigator.userAgent.toLowerCase())&&(a.deviceModelName="msie"),/mozilla/.test(navigator.userAgent.toLowerCase())&&(a.deviceModelName="mozilla"),/safari/.test(navigator.userAgent.toLowerCase())&&(a.deviceModelName="safari"),/opera/.test(navigator.userAgent.toLowerCase())&&(a.deviceModelName="opera"),/chrome/.test(navigator.userAgent.toLowerCase())&&(a.deviceModelName="crome"),a.osVersion=$.browser.version,a.osType="WEB";return a}function getGeoLocationInfo(a){if(navigator.geolocation){var b={};navigator.geolocation.getCurrentPosition(function(c){b.code="1",b.message="",b.latitude=c.coords.latitude,b.longitude=c.coords.longitude,b.coordinates=c.coords.latitude+","+c.coords.longitude,a(b)},function(c){var d="";switch(c.code){case c.PERMISSION_DENIED:d="No privilige for location information!";break;case c.POSITION_UNAVAILABLE:d="Can't find current location information!";break;case c.PERMISSION_DENIED_TIMEOUT:d="Location information retrieval timed out!";break;default:d="Failed to get location information."}b.code="0",b.errorCode=c.code,b.message=d,a(b)},{timeout:1e4})}else a(null)}function sleep(a){for(var b=(new Date).getTime();(new Date).getTime()<b+a;);}function gf_GetPriv(a,b,c){var d=!1;c&&(a.SessionInfo=angular.copy(c.init()));var e;a.$root.$state?e=a.$root.$state.current.name:(e=document.location.href,e=e.substring(e.lastIndexOf("/")+1,e.length));var f=a.SessionInfo.getCurrentPriv();if(null==f||0==f.length)d=!0;else for(var g=0;g<f.length;g++)if(f[g].menu_url==e){d="Y"==f[g][b]?!0:!1;break}return d}function gf_GetDoc(a){return a.document||a.contentDocument||a.contentWindow.document}function sortByKey(a,b){return a.sort(function(a,c){var d=a[b],e=c[b];return"string"==typeof d&&(d=d.toLowerCase(),e=e.toLowerCase()),e>d?-1:d>e?1:0})}function gf_GetPageScroll(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),new Array(a,b)}function gf_GetPageHeight(){var a;return self.innerHeight?a=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&(a=document.body.clientHeight),a}function onMessage(a){writeMsg(a.data)}function onError(a){writeMsg(a.data)}function doSend(a){var b={chatroom:$("#chatroom").text(),username:$("#username").val(),text:a};websocket.send(JSON.stringify(b))}function writeMsg(a){var b=JSON.parse(a),c='<span style="color: blue;"> > '+b.text+"</span>",d=document.createElement("p");d.style.wordWrap="break-word",d.innerHTML=c,$("#output")[0].appendChild(d),writeLog(JSON.stringify(b))}function writeLog(a,b){if(config.debug){var c;c=b?'<span style="color: red;">ERROR > '+a+"</span><br>":'<span style="color: blue;"> > '+a+"</span><br>";var d=document.createElement("p2");d.style.wordWrap="break-word",d.innerHTML=c,$("#output2")[0].appendChild(d)}}var config={debug:!0};angular.module("chatroomApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","httpIntercepter"]).constant("config",config).config(["$stateProvider","$urlRouterProvider","$httpProvider","$provide",function(a,b,c,d){c.defaults.useXDomain=!0,c.defaults.headers.common["Access-Control-Allow-Headers"]="*",a.state("index",{url:"",templateUrl:"views/chatroom.html",controller:"ChatRoomCtrl"}).state("chatRooms",{url:"/main",templateUrl:"views/chatroom.html",controller:"ChatRoomCtrl"}).state("chat",{url:"/main/:chatroom",templateUrl:"views/chat.html",controller:"ChatCtrl"}),c.interceptors.push("httpinterceptor")}]),angular.module("chatroomApp").factory("$exceptionHandler",function(){return function(a,b){if("Cannot read property 'resolve' of undefined"==a.message)return void console.log(a.message);if(a.message&&a.message.startsWith("[$resource:badcfg]"))a.message+=' (caused by "'+b+'")';else{var c={title:a.message,date:moment().utc().toDate().format("YYYYMMDD HH:mm:ss:SS"),stack:a.stack};console.log(c.stack),console.log("sent error message to the server!"+JSON.stringify(c))}}});var objControl=function(){};objControl.prototype.isCollection=function(a){return gf_IsNull(a.length)?!1:!0},objControl.prototype.enableObj=function(a){if("string"==typeof a&&(a=document.getElementsByName(a)),this.isCollection(a))for(var b=0;b<a.length;b++)a[b].disabled=!1;else a.disabled=!1},objControl.prototype.disableObj=function(a){if("string"==typeof a&&(a=document.getElementsByName(a)),this.isCollection(a))for(var b=0;b<a.length;b++)a[b].disabled=!0;else a.disabled=!0},objControl.prototype.enable=function(a,b){if("string"==$.type(a))if(a.indexOf(",")<=-1)b?this.enableObj(document.getElementsByName(a)):this.disableObj(document.getElementsByName(a));else for(var c=a.split(","),d=0;d<c.length;d++){var e=document.getElementsByName(c[d]);b?this.enableObj(e):this.disableObj(e)}};var gf_Objs=new objControl;String.prototype.replaceAll=function(a,b){var c=null,d=new RegExp(a,"g");return c=this.replace(d,b)},String.prototype.simpleReplace=function(a,b){var c=a;c=c.replace(/\\/g,"\\\\"),c=c.replace(/\^/g,"\\^"),c=c.replace(/\$/g,"\\$"),c=c.replace(/\*/g,"\\*"),c=c.replace(/\+/g,"\\+"),c=c.replace(/\?/g,"\\?"),c=c.replace(/\./g,"\\."),c=c.replace(/\(/g,"\\("),c=c.replace(/\)/g,"\\)"),c=c.replace(/\|/g,"\\|"),c=c.replace(/\,/g,"\\,"),c=c.replace(/\{/g,"\\{"),c=c.replace(/\}/g,"\\}"),c=c.replace(/\[/g,"\\["),c=c.replace(/\]/g,"\\]"),c=c.replace(/\-/g,"\\-");var d=new RegExp(c,"g");return this.replace(d,b)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},String.prototype.startsWith=function(a){return this.slice(0,a.length)==a},String.prototype.endsWith=function(a){return this.slice(-a.length)==a};var GLB_MONTH_IN_YEAR=["January","February","March","April","May","June","July","August","September","October","November","December"],GLB_SHORT_MONTH_IN_YEAR=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],GLB_DAY_IN_WEEK=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],GLB_SHORT_DAY_IN_WEEK=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];Date.prototype.format=function(a){var b,c=this.getFullYear(),d=this.getMonth()+1,e=this.getDate(),f=this.getDay(),g=this.getHours(),h=12>g?"AM":"PM",i=g>12?g-12:g,j=this.getMinutes(),k=this.getSeconds(),l=""+c,m=l.substr(2),n=1==(""+d).length?"0"+d:""+d,o=GLB_MONTH_IN_YEAR[d-1],p=GLB_SHORT_MONTH_IN_YEAR[d-1],q=1==(""+e).length?"0"+e:""+e,r=GLB_DAY_IN_WEEK[f],e=GLB_SHORT_DAY_IN_WEEK[f],s=1==(""+g).length?"0"+g:""+g,t=1==(""+i).length?"0"+i:""+i,u=1==(""+j).length?"0"+j:""+j,v=1==(""+k).length?"0"+k:""+k,w=""+this.getMilliseconds();return b="undefined"==typeof a?"DDMMYYYY":a,b=b.replace(/YYYY/g,l),b=b.replace(/YY/g,m),b=b.replace(/MM/g,n),b=b.replace(/MON/g,o),b=b.replace(/mon/g,p),b=b.replace(/DD/g,q),b=b.replace(/DAY/g,r),b=b.replace(/day/g,e),b=b.replace(/hh/g,t),b=b.replace(/HH/g,s),b=b.replace(/mm/g,u),b=b.replace(/ss/g,v),b=b.replace(/SS/g,w),b=b.replace(/(\s+)a/g,"$1"+h)},Date.prototype.after=function(a,b,c,d,e,f,g){return null==a&&(a=0),null==b&&(b=0),null==c&&(c=0),null==d&&(d=0),null==e&&(e=0),null==f&&(f=0),null==g&&(g=0),0!=a&&this.addYear(a),0!=b&&this.addMonth(b),0!=c&&this.addDate(c),0!=d&&this.addHours(d),0!=e&&this.addMinutes(e),0!=f&&this.addSeconds(f),0!=g&&this.addMilliseconds(g),this},Date.prototype.before=function(a,b,c,d,e,f,g){return null==a&&(a=0),null==b&&(b=0),null==c&&(c=0),null==d&&(d=0),null==e&&(e=0),null==f&&(f=0),null==g&&(g=0),0!=a&&this.addYear(-1*a),0!=b&&this.addMonth(-1*b),0!=c&&this.addDate(-1*c),0!=d&&this.addHours(-1*d),0!=e&&this.addMinutes(-1*e),0!=f&&this.addSeconds(-1*f),0!=g&&this.addMilliseconds(-1*g),this},Date.prototype.addYear=function(a){this.setFullYear(this.getFullYear()+a)},Date.prototype.addMonth=function(a){this.setMonth(this.getMonth()+a)},Date.prototype.addDate=function(a){this.setDate(this.getDate()+a)},Date.prototype.addHours=function(a){this.setHours(this.getHours()+a)},Date.prototype.addMinutes=function(a){this.setMinutes(this.getMinutes()+a)},Date.prototype.addSeconds=function(a){this.setSeconds(this.getSeconds()+a)},Date.prototype.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+a)},Date.prototype.period=function(a,b){"string"!=typeof a&&(b=a,a="year");var c=this.getYear(),d=b.getYear(),e=this.getMonth()+1,f=b.getMonth()+1,g=this.getTime(),h=b.getTime();return"year"==a?d-c:"month"==a?12*(d-c)+(f-e):"date"==a?Math.floor((h-g)/1e3/60/60/24):"hour"==a?Math.floor((h-g)/1e3/60/60):"minute"==a?Math.floor((h-g)/1e3/60):"second"==a?Math.floor((h-g)/1e3):void 0},Date.prototype.getLocalDate=function(a){return 0>a?(a=-1*a,this.before(null,null,null,a,null,null,null)):this.after(null,null,null,a,null,null,null),this},Array.prototype.contains=function(a){for(var b in this)if(this[b]==a)return!0;return!1},String.prototype.padstring=function(a,b,c){var d=this;if("string"==typeof a&&1===a.length&&b>this.length){var e=new Array(b-this.length+1).join(a);d=c?d+e:e+d}return d},!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.ReconnectingWebSocket=b()}(this,function(){function a(b,c,d){function e(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!1,!1,b),c}var f={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3};d||(d={});for(var g in f)this[g]="undefined"!=typeof d[g]?d[g]:f[g];this.url=b,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var h,i=this,j=!1,k=!1,l=document.createElement("div");l.addEventListener("open",function(a){i.onopen(a)}),l.addEventListener("close",function(a){i.onclose(a)}),l.addEventListener("connecting",function(a){i.onconnecting(a)}),l.addEventListener("message",function(a){i.onmessage(a)}),l.addEventListener("error",function(a){i.onerror(a)}),this.addEventListener=l.addEventListener.bind(l),this.removeEventListener=l.removeEventListener.bind(l),this.dispatchEvent=l.dispatchEvent.bind(l),this.open=function(b){h=new WebSocket(i.url,c||[]),b||l.dispatchEvent(e("connecting")),(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",i.url);var d=h,f=setTimeout(function(){(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",i.url),k=!0,d.close(),k=!1},i.timeoutInterval);h.onopen=function(){clearTimeout(f),(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onopen",i.url),i.protocol=h.protocol,i.readyState=WebSocket.OPEN,i.reconnectAttempts=0;var c=e("open");c.isReconnect=b,b=!1,l.dispatchEvent(c)},h.onclose=function(c){if(clearTimeout(f),h=null,j)i.readyState=WebSocket.CLOSED,l.dispatchEvent(e("close"));else{i.readyState=WebSocket.CONNECTING;var d=e("connecting");d.code=c.code,d.reason=c.reason,d.wasClean=c.wasClean,l.dispatchEvent(d),b||k||((i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onclose",i.url),l.dispatchEvent(e("close")));var f=i.reconnectInterval*Math.pow(i.reconnectDecay,i.reconnectAttempts);setTimeout(function(){i.reconnectAttempts++,i.open(!0)},f>i.maxReconnectInterval?i.maxReconnectInterval:f)}},h.onmessage=function(b){(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",i.url,b.data);var c=e("message");c.data=b.data,l.dispatchEvent(c)},h.onerror=function(b){(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onerror",i.url,b),l.dispatchEvent(e("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(b){if(h)return(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","send",i.url,b),h.send(b);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(a,b){"undefined"==typeof a&&(a=1e3),j=!0,h&&h.close(a,b)},this.refresh=function(){h&&h.close()}}return a.prototype.onopen=function(){},a.prototype.onclose=function(){},a.prototype.onconnecting=function(){},a.prototype.onmessage=function(){},a.prototype.onerror=function(){},a.debugAll=!1,a.CONNECTING=WebSocket.CONNECTING,a.OPEN=WebSocket.OPEN,a.CLOSING=WebSocket.CLOSING,a.CLOSED=WebSocket.CLOSED,a}),angular.module("httpIntercepter",[]).factory("httpinterceptor",["$q","$rootScope","msgconst","config",function(a,b,c,d){var e=function(a){a&&(b.running=!0)},f=function(a){a&&(b.running=!1)};return{request:function(b){return e(b),b.url.trim().endsWith("html")||(b.headers=b.headers||{}),b||a.when(b)},requestError:function(b){return f(b.req),a.reject(b)},response:function(b){return f(b.req),b||a.when(b)},responseError:function(b){f(b.req);var d=b.status,e="",g="";return 400==d||401==d||403==d||404==d||500==d?(g+=c["httpStatus_"+d].code,e+=c["httpStatus_"+d].message,500==d&&(e+=b.data,alert(e))):(g+="Server Error",e+=b.req?"HTTP: "+b.req.method+" on "+b.req.url+" failed.":"HTTP: "+b.config.method+" failed."),console.error("["+g+", HTTP:"+d+"], message="+e),a.reject(b)}}}]),angular.module("chatroomApp").value("msgconst",{httpStatus_400:{code:"BAD_REQUEST",message:"You send a Bad Request. send the right thing."},httpStatus_401:{code:"UNAUTHORIZED",message:"Login Required. Or Your login info is expired."},httpStatus_403:{code:"FORBIDDEN",message:"Your Authorized is forbidden. Request the autorization to admin."},httpStatus_404:{code:"NOT FOUND",message:"Not found the content."},httpStatus_500:{code:"SERVER ERROR",message:"Internal Server Error"}});var gMsg=new coMessage,gf_List2jsonWithLevel=function(a,b,c,d,e){function f(b,g){for(var h,j=0;h=b[j];j++){if(h[c]===g[d]){g.children=[],h.children.push(g),i++,a.splice(a.indexOf(g),1),h.children.sort(function(a,b){return a[e]<b[e]?-1:a[e]>b[e]?1:0});break}h.children.length&&f(h.children,g)}}for(var g=[],h=a.length,i=0,j=0;i!=h&&h!=j++;)for(var k,l=0;k=a[l];l++){if(k[d]===b){k.children=[],g.push(k),i++,a.splice(l,1),g.sort(function(a,b){return a[e]<b[e]?-1:a[e]>b[e]?1:0});break}f(g,k)}return g},gf_GetUniqueNumber=function(a){var b="",c=[["a","b","S","T","0","1"],["c","d","Q","R","2","3"],["e","f","O","P","4","5"],["g","h","M","N","6","7"],["i","j","K","L","8","9"],["k","l","I","J","U","V"],["m","n","G","H","W","X"],["o","p","E","F","Y","u"],["q","r","C","D","v","w"],["s","t","A","B","x","y"]];try{for(;a>0;){var d=parseInt(a%10),e=Math.floor(6*Math.random());b+=c[d][e],a=Math.floor(a/10)}b=b.split("").reverse().join("")}catch(f){return f}return b},gf_CopyUrlToClipboard=function(a){return a="http://locket.me/"+a,window.clipboardData&&window.clipboardData.setData("Text",a),a},gf_CreateFaviconImgUrl=function(a,b,c,d){var e={image_url:b,site:c};a.post("/v1/faviconImgUrl",e).success(function(a,b,c,e){a.filePath=document.location.origin+"/"+a.filePath,d(a)}).error(function(a,b,c,d){alert("There was a problem loading the favicon.")})},gf_SetItem=function(a,b){},gf_GetItem=function(a,b){},gf_LookupDs=function(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e][b]==c+""){d(e);break}};angular.module("chatroomApp").controller("MainCtrl",["$scope",function(a){}]),angular.module("chatroomApp").controller("ChatCtrl",["$scope","$http","$state","$stateParams","$timeout","config","ChatService",function(a,b,c,d,e,f,g){a.init=function(){a.chatroom=d.chatroom},a.valiate=function(){return a.chatroom?a.username?!0:(writeLog("User name is null!",!0),$("#username")[0].focus(),!1):(writeLog("Chat room is null!",!0),$("#chatroom")[0].focus(),!1)};var h;a.join=function(){if(a.valiate()){var b={type:"join",chatroom:a.chatroom,username:a.username},c=document.location.origin;c=c.replace("http","ws"),h=c+"/chatroom/chat/"+JSON.stringify(b),websocket=new ReconnectingWebSocket(h,null,{debug:!1,reconnectInterval:3e3}),a.text="",$("#text")[0].focus();{$("#output")[0],$("#output2")[0]}websocket.onopen=function(a){},websocket.onclose=function(a){writeMsg("{passed out...}")},websocket.onmessage=function(a){onMessage(a)},websocket.onerror=function(a){onError(a)}}},a.quit=function(){var b={type:"quit",chatroom:a.chatroom,username:a.username};websocket&&(websocket.send(JSON.stringify(b)),websocket.close()),c.go("chatRooms")},a.talk=function(){if(a.valiate()){if(!a.text)return writeLog("Text is null!",!0),$("#text")[0].focus(),!1;var b={type:"talk",chatroom:a.chatroom,username:a.username,text:a.text};a.text="",websocket.send(JSON.stringify(b))}},a.clear=function(){$("#output").text(""),$("#output2").text("")}}]),angular.module("chatroomApp").factory("ChatService",["$resource","config",function(a,b){return{J:a("/chatroom/join/:username",{username:"@username"}),R:a("/bbs/:id",{id:"@id"})}}]),angular.module("chatroomApp").controller("ChatRoomCtrl",["$scope","$http","$state","ChatroomService",function(a,b,c,d){a.retrieve=function(){d.L.get({},function(b){b.result&&(a.chatrooms=b.result)},function(a){})},a.insert=function(){if(!a.chatroom)return writeLog("Chat room is null!",!0),$("#chatroom")[0].focus(),!1;var b={chatroom:a.chatroom};d.CUD.save(b,function(b){0==b.code&&(a.chatrooms[a.chatrooms.length]={},a.chatrooms[a.chatrooms.length-1].name=a.chatroom),$("#chatroom").val("")},function(a){})},a["delete"]=function(b,c){var e=a.chatrooms[c];d.CUD["delete"](e,function(b){0==b.code&&a.chatrooms.splice(c,1)},function(a){})},a.join=function(a){c.go("chat",{chatroom:a.name})}}]),angular.module("chatroomApp").factory("ChatroomService",["$resource","config",function(a,b){return{L:a("/chatrooms/:page",{page:"@page"}),R:a("/chatroom/:page",{page:"@page"}),CUD:a("/chatroom/:page",{page:"@page"},{update:{method:"PUT"}})}}]);